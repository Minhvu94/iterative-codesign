function [Y,Xf,Af,x1_step1,y1_step1] = myNN(X,~,~)
%MYNN neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 16-Oct-2020 13:34:58.
% 
% [Y] = myNN(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 4xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0;3.12517277205283;0;-0.141032368758821;0.00366496403469972];
x1_step1.gain = [4.0176375495301;50.1532120542852;6.10803509747399;7.50244307078854;6.80597452902636];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.2554717272513444826;1.5582704260482993508;-5.0065287071882211833;0.87788503296391207087;-1.1535295559829297218;0.0821464127760640761;-0.013538424614851997732;0.11402028851250121944;-1.243996487593409972;-2.16877854014375826;0.097235051934480246083;0.079072071291005172067;-0.69371057920620193826;-1.7278885330906972317;1.5680532166041416531;1.5683770353970967193;-1.4527820991599011968;-3.4519734548549059205;-0.096448325653985950145;1.9407019764322759325];
IW1_1 = [-0.0096812442503610724592 0.015808100222931741052 -0.023120986965599960722 0.012718878756339237202 -0.0070982189566845283607;-0.0037779842499603244303 0.0018247874552114091724 -0.0083512972762066033094 -0.015546311935616549671 -0.002586519289193117601;-0.024566890127784311859 -0.029556773306155335185 -0.020736278870443852762 -0.0078852144277936839223 -0.0038929338805031642005;-0.011094202401355906032 -0.010132500716515979375 0.0035307832888261435692 0.0063857155223229220345 -0.0016630759564615429664;0.058705534073723260324 -0.0019505896329146308298 0.00043399180675246057078 8.4667401815561259791e-05 -0.00024047915521115085656;-0.0062252997025655943536 -0.0050271262819827494672 -0.0067423395881087882023 0.0040083738373329711596 0.0017719958890339121936;0.0018124036600317301998 0.0012679385507181086239 -0.0064004647398504029704 -0.0016537336865398851674 0.0028496375225150472055;0.0017672782358568526594 0.020575512213216157198 -0.0024285681279854775573 0.0011582842214633536082 0.0046578047195711038547;-0.0027312619725401309119 0.0030356796591647998949 -0.0072010219027562874169 -0.010192980264955714409 -0.0023208187187011191169;-0.01192643778045854655 -0.013226591434065213676 -0.017886038169407626752 -0.0088798243624639179583 -0.0029784747498046442067;-0.0082313930227458365074 -0.0018816664405605996579 -0.0030605416520975018205 -0.0015850951936938954649 -0.0016637558800702222615;0.0021013678386914832683 0.023801398092299363984 0.0058148687605185716762 0.0012596261983306145365 -0.0027920387275188192182;-0.0017576926061172893235 -0.0062758200628185217482 0.0084745223112471009669 -0.0026995304833480624276 -8.2343349276574480909e-05;-0.0081864631248882002018 -0.0099494614361619135995 0.0024583922643065499528 0.0051789114476672865051 -0.0023931962321055654484;0.48850814292110394943 -0.73715722820480988897 -0.4838093461073104673 0.73573038730332351864 0.36237873674687920422;0.48903131075926825622 -0.73727015580702881525 -0.48379299216204774137 0.73595828288245601634 0.36219168695119580148;-0.083608796875884683342 0.0027735007388242135379 -0.00055022609298864566009 -0.00011476701869057886378 0.00046642581951805532625;0.018345484371311972932 0.022492922757930765287 0.030091916032204676229 -0.0085356961741102996971 -0.0016890797750239217902;-0.0016237203691892175463 0.0051717384560661661119 -0.009054187143138764729 0.0013456008168097612857 0.0020815824398352149142;0.0042507309314005108439 -0.0073638460744211552828 0.034213644688628745694 -0.012053272798597287549 0.0060010291323018992091];

% Layer 2
b2 = [1.7953796952119629449;-0.96442159172649077892;-0.0844042040276583444;1.8302466721245747028;-1.4418957044872486861;0.03065649400231348215;1.3045619066916460671;0.46146966580054782359;0.055679580898080532902;-1.4024988672935176925;-1.0207867718839549465;-2.1140506485397736469;-0.093258960049867417608;2.716453447111034869;1.0806432147442290859;0.45742610304414971223;1.8450734508978685611;0.33320791044348629928;-0.98492128030836412211;-1.4860411587298829605];
LW2_1 = [-0.42747467218504081599 0.63009107633513261604 0.22063757245947512864 0.59588980616938180823 -0.29580972319093551404 0.19270136358627779072 1.221857823471162785 0.079956192321852179172 -0.15029534596075636022 1.2587088888512161233 1.2669811377495128202 -0.16162201707506931858 1.1535346868976523727 1.0144611789134845292 0.14735538631506048257 -0.14496039789924564101 0.15485051943145888842 0.38249180753343436923 -0.91322754832017383197 1.6057579292001114002;0.12971771193657288812 -0.12132546791817981624 -1.9101968353323963701 -1.2749700041370828352 0.3057746826636222881 -0.52562682538998539705 -1.9523870491027719432 0.072476277686750412155 -0.67418115299822189979 0.074614005577530270741 -0.3696072899925900157 -0.42811575725915623769 1.2583523534192977422 -2.9168709914500601244 -0.26038954321085416854 0.26032807213907777077 0.36999548774480145452 1.6285715129111679733 0.28049069005611781957 -0.15866821804447064914;-2.4520206626032554631 -0.13955527304594889104 0.24212675042913373025 -0.68848682089416279872 -0.7337005533545458702 1.3519313282349783023 -1.5634439338791561447 0.83520259373626337673 -0.17773387269557994195 -1.3268687912452190591 -0.24051988500544083105 0.15582341864101645346 -0.59205026864709497936 -0.0078278551311054076628 -0.026129441071798976265 0.025293252628800041992 -0.41385680091059601216 -0.19229216719711203498 -1.4422757290572831845 -0.1711215867496759524;-0.66579602320907949053 0.20741531526609643943 0.86189106511357926887 0.48490774346750131762 0.005467749166619084028 -0.0054898820898204424984 1.5600153754800760719 -0.41253106741726747186 -0.091347964200257730782 1.6550637418539086987 1.8713490978820925825 0.15120904073637569942 0.37964105879335685589 -0.88246077334348826948 -0.31560765314461786124 0.31400213594964304642 -0.51790012984041200461 -0.48988322197358258325 -0.074534007817445832589 -0.85271024680543405783;1.0208001139169193827 -0.74799666376223794551 0.086088174842060979919 -0.21485152347803990192 -0.16593651138225548602 1.5472551808778727267 -1.3725761021790165994 -0.15112296844738465351 -0.16949369907136838109 -0.7327410100046424235 -1.8871591121644131217 0.33967742923713345471 0.54822071297341523621 -1.4211681731471963452 0.018529564881218461153 -0.01933477781522898592 0.29391982906685454324 0.23336523897303060315 0.83314351238999428961 0.17030189411095394969;0.37051188534182155632 -0.088838223901066090682 -1.4591066772166949583 -1.3053597648886610116 -0.11430427801492286377 -0.72138211020764331227 -0.84994044078230657213 0.42408740530502642141 -1.0218203233908262906 -0.025222244089478075557 -0.76330487066323648992 -0.36207599831000919499 -1.734136378601861761 -0.95446734483646133995 0.31631023348043635357 -0.31602404115993792955 0.56760157069793659712 1.4507955673095023208 -0.77836088773718825617 -0.61331586719233865956;-2.327630282236213155 0.95364023518055007766 -0.16327105223512156096 0.75861521316143354365 -0.34329427070986040516 -0.24126117736218036236 1.3486611262475931561 0.33006711124940146806 0.92972553111806011117 -0.17436852928885296365 -2.7195550264843770805 -0.30128815270247305547 1.3116690009041021003 -0.34829449996135647405 -0.18418062111151792259 0.18398818144674999875 0.49238051439902003059 0.34082524526989627089 -1.394289650048411433 1.3621933469337075273;1.2589446070017336066 -0.85032111681265587499 1.3893529279319329905 1.2033327789070793479 0.11082404487245857416 -0.1064948405165579981 1.0893852499455862759 0.15133151419975393592 -1.0280597171402183765 0.183326845069738259 -0.27956018601262477841 -0.74143747969260243025 -1.3647981807558600131 2.2926322054556425023 0.13084388656332460177 -0.13298448634940723823 0.88462197990161295369 -0.091373464478484794915 0.61377486587534046958 -0.19825171734106866728;-0.22660806831052188182 -0.26675404922245965489 -0.13524683396619022191 0.23014880212507701773 -2.8171717027597931171 -0.52600323224030987035 0.64566991418141828074 0.1176829896796645486 -0.21340296374318432071 0.055093722854974658265 -0.094715831793612939582 -0.18351515079368757588 0.041167367561565783307 0.37772005232685712528 0.17245445369781606249 -0.17253677524597371695 1.7979349824288175519 0.048185600067248687828 -0.090117582914642932468 -0.24145128380284508474;-1.4858266413140308604 0.25568134776065787328 -0.39744141257516885091 -0.5953304210651936268 -0.078129490810647142518 -0.68813785995711718169 0.68026934082084322686 -0.29186515493663067744 0.033823521262876424243 -0.38498157710505759299 0.75688982629561041282 0.23806649315588560012 -0.089083596294935965543 -3.1913297819124033516 0.23011494585035668914 -0.23036562069146157561 -0.46596741659690654735 0.97648772118388205143 0.52378091952457928038 0.053923398939531318186;1.7010340905938854394 -0.81141888994655164691 -0.67006635609590547986 -0.15513196082562971667 -0.27541114844571157327 0.61715305548936882918 -1.3132627403252608023 0.11707273349118858807 -0.68581823255537888162 0.16602022547625366888 2.3038212390226968651 -0.12174684144426280163 -2.3726633281855402657 0.20119217992483270918 0.30867376466650764399 -0.309484822483524602 -0.71662738199121811533 -0.48844667147932468998 0.20532494103415144249 -2.9694419602260939683;2.1047702763270033088 1.4448153774243543968 0.19175114137599139075 -0.15887031942695259423 0.89405847924897985379 1.5973610849444537241 -1.1672735208996238843 -0.020059927954341721934 0.63305491448775708108 -0.13108448781043080533 1.514266577870774233 0.43269366868196451614 -0.12580453171134819979 -1.4472111198588191172 0.23930375973475911944 -0.23844951669447148057 -0.076138517890931220466 0.44041375932059245724 1.4195161565462484088 -0.4392178856739838988;0.044178466163434848557 1.4505164138076716007 0.2513300522068739884 0.26588512719267826112 -0.37865737258127935005 0.7892426937116123753 0.68649025496505855504 -0.56596423938127016218 -0.13302822922704113373 1.4565519924867100787 1.0324883638530610863 1.4066593374625944168 0.8309212000028098899 0.65301956819047768388 0.013457673671214819694 -0.013613503022403824344 -0.33782724206068720507 -0.98729422590732540677 -1.0960426377526004682 0.38240677842700282474;-1.864432156630516646 0.63650487057000759705 0.62757642254686296646 -0.75251202590787358293 -0.08708078378179986978 0.0046373326109995678668 0.81710155450928345644 -0.13013764440655795074 2.3554714377366097189 -0.12501247463519327141 2.1177081884940327505 0.51994639042920809402 0.019529222982526916325 -1.4490947919782735109 0.24011652673562702831 -0.24107317408016964988 -0.080276370737268010203 -0.11618686591608072545 -1.1109588986696052881 -0.056628964588452561368;-0.96516403431717068262 -0.004349488455111315266 0.098189228040537424036 0.14696629549482659316 0.25520032156615546359 1.0523944205568676047 0.44926684366441865803 -0.25637402705670730985 -0.040660201342647438183 -0.71719918776921687265 2.1787253745956749462 0.031426443215708005363 -1.1272928120545606667 1.2500685289433959291 -0.28333461709433566122 0.28255209483726406727 -0.66232745462226061406 -0.69585301160603807435 -0.14402880887017918687 -0.68363427373358121031;-0.84235689030480942474 -0.51857567411328098217 -0.072344053313319472975 -1.0291039163852189198 -0.89334698521593647325 0.33468571478359010474 1.2249594087841035872 -0.84882304054748081157 1.7876579772388545564 0.56866966315576539248 0.63185561918713217811 1.261105532333520074 -0.38263289656586402243 -0.081663600588861670615 0.35775769301477428064 -0.35780202255540510814 -0.7818031628876500605 0.060309779230443949505 -1.3775411865929976241 1.1943436824300361909;-0.33212191898010623436 -2.2178587788921428903 0.012948861792773965276 -0.28843297053696165255 -0.58050437758558437462 -0.322729149132413351 -1.2451663155069421229 -0.11155936795951079676 -0.89549125829232956164 -0.057740075564184395462 -0.82782278574008072436 -0.021566597044402641137 -0.073779126281916004859 1.7880241535774179518 -0.12596661735435199514 0.12628328624824530779 -0.31982031645486819205 -0.45649197849898620616 0.16620670866963355161 1.1897770549020199038;2.0229707218316090866 -1.4232566903770305089 0.15747724788167027921 1.993796229432911904 0.3547285740690118705 -1.1419176214373079059 -0.0060417555511250798164 0.67070540245092791221 -1.6692231280966409734 -1.0459342002011917661 -1.4042600490496457422 -1.7830569606319948139 -0.64016310082659821923 1.3897108658702466144 -0.55372054494207068043 0.55417826874306019835 0.33418562651832989241 0.084596355269419942768 1.5908486550602622955 -0.60664451538316277457;0.174221222393468822 0.19920618499973163917 0.096416916291602955402 -0.15314112927634115913 -2.1552266151306063158 0.35123465556912703001 -0.61581452395630331687 -0.091634607070467111178 0.15594629463101161715 -0.041488430677116112932 0.20148998677245530398 0.141004966256558395 -0.05665583391764315857 -0.25951478966323793252 -0.11699549658280813946 0.11705469056630099511 1.574231731610032714 -0.037455645569653583937 0.096063600601452150962 0.16289198521971653966;-0.18524631063577606804 0.49650914943763663212 -0.92819486599935019377 0.030144652077370281268 -0.45451105424008936273 -0.8800280351498751541 0.77057986244512532981 -0.15558533297264140471 0.23744541990026271638 -0.16783906844954946114 -1.7421807466209831006 0.26610433788441695269 0.26189148220982960691 -2.0350328948587725897 -0.31693483567947561275 0.31656504662288798002 0.64834911333099942699 1.1680891580588779188 0.1276510169793428906 0.27742027528936624714];

% Layer 3
b3 = [-0.79195643550763594742;-9.7024277500419451314;3.9633456918882634668;-6.3298223482266404716];
LW3_2 = [-0.34885241834273317263 0.46815491314938662004 -0.06857661800164341348 -0.36693075448592793464 0.36624956675290892827 0.57213693235599516473 -0.32267372749348877115 -0.38660893619641606422 -5.416498405856668974 0.54136606827593192204 0.2771793661388924912 0.3276739263893334031 -0.32355941609306682061 0.009577316203933239 -0.40899193739785588697 0.1256286735051252712 -0.14779960185771937042 -0.07801513805667331658 -7.5989713958057567567 0.52864457622698191042;-12.472609006637037865 12.96253243934290289 -3.2935663156206000934 -13.098611112304775261 12.764245411168085198 17.918797746894547629 -11.26340658939802708 -11.215996135559061386 4.1258539447387931887 14.986132313011047756 10.113452382733301604 10.243594583254123975 -11.845875810670621675 -0.38603188895215162502 -12.803126855335861478 2.5231778513196627678 -4.9267160035139179186 -1.6854142511603820154 3.7966455498422240211 15.970978125601558162;2.4838504725732684086 6.0561262705164038422 8.9695731363379636036 -5.7415629928823399553 1.3879254498465336543 2.3827731918137562417 13.378125105433239739 -3.6872954265745110369 8.5693524564256335907 -0.0052508371796107485355 -8.5214711411969865651 -14.274928905026593284 -2.9265234321503239556 -2.1775673692583681351 -2.8976240941621602687 -1.9527290174698139769 10.701972824602890455 1.7488366186723083295 -5.1587814485061107561 3.5126822402156814285;-3.6486537832934446968 -9.7039505448722387371 8.959182503798524877 -6.3913673319370172266 11.791976284494063876 2.3339889396173338909 -11.736660382711088246 6.3947243369578963268 -1.0714846402397921743 -10.782330680475858742 12.908640812768421569 -4.4034092343535293779 -7.580945620237240945 -15.278364357833167375 -2.5034415906409974717 -13.813938644308041859 9.4286723784967367834 10.973213835613945477 -1.2561322579721618808 -0.89638019512170630243];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [4.0017691663405;50.1532120542852;7.15802314698764;7.50244307078854];
y1_step1.xoffset = [0.000244731111809708;3.12517277205283;0.0480307899561394;-0.141032368758821];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end

