function [Y,Xf,Af,x1_step1,y1_step1] = myNN(X,~,~)
%MYNN neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 16-Oct-2020 12:29:45.
% 
% [Y] = myNN(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [3.11338794660377;0;-0.238730901736533;0.000266360574456115];
x1_step1.gain = [31.0509069344898;3.59292635663048;4.21031399789945;4.03605355305272];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.3362624639372056023;2.8473038873544682659;2.338955178807112123;2.4904596861818757425;-0.65206755498719737307;1.4274287367198952303;-0.29219976112015466629;0.042609375270848563744;-0.65546546388610071876;0.58963695950528993706;0.42905080020111674433;0.10268318971541802453;1.2949592901140041246;0.0037247066296992150172;-1.2963362444595722955;-1.4097536525624880799;2.4282346606138127676;-1.6927227172277279355;2.7409485793955514765;1.5838031552485190012];
IW1_1 = [-0.00034272183111172071883 0.048905093473672694993 -0.049619389458171542229 0.0076458815038452860105;-0.33244524130788699612 -0.74523836151103339809 -0.26267846521670634719 0.3679123662325377575;0.0053825136776832838495 0.032952862739879199006 0.019585904510418992996 0.0036814651993116159073;0.022820383582862521776 -0.021196055238229493528 -0.0022537676810414314192 0.015321059896531786029;-0.011185081290695180964 0.017849693228253391691 0.0038933401430961299058 0.0044065882927532291219;-0.43270920887469471738 0.025065562179401836701 -0.83027450381259315648 0.14525812891813752459;0.018915587999939371955 -0.039595601200925138741 0.0029046026449023915235 -0.0077128269082562834341;-0.034666723139624426586 -0.0087155455115622889467 -0.0034615312456718243597 0.0046643852346694558014;0.047638940022978297495 0.0059700057770734468385 -0.010878465785593587067 -0.0047736954436445521929;-0.00075431559163278657544 0.028451877639080410537 0.011221053860860639648 0.0024397501901175394114;0.00036045845348912941043 0.011805719474031001193 -0.012688207147187777549 0.0017468738853637527132;0.016985021888397934531 -0.0032892793975506651183 -0.005360584804118559768 0.0079845141038875216966;0.0032506556168325744655 -0.0441458298042238656 -0.016029914497041407306 -0.0036396879244174180044;0.032838563260013366174 0.0079103667445763539701 0.0079629346313704781057 0.00027872354663832513491;-0.038267875844499109339 -0.054268861828064243746 0.030821755695986555873 -0.011723713063258140235;-0.013128174610874111111 -0.03081114912347141313 -0.0075377360384129435747 0.016433561367933561398;0.00027423409895297563236 -0.039227958441405648415 0.03931112076305003783 -0.0047942948949093004696;-0.017575139079729958785 -0.019013222487854978399 -0.026923831983888653341 0.00013729572395144900633;0.450919866364466293 -0.15326689024194142807 0.45133714490768095384 -0.18496615771166588504;0.019326708744314927135 0.015019291809532400034 -0.030294172673754976577 0.0052260627556066302848];

% Layer 2
b2 = [0.94653886122696595518;-0.45622581032344283747;0.54939378672073357901;1.3134524979134230005;1.1305895327973312092;-0.29445859099189219954;0.34018526081856015342;0.53622413594192996911;0.020624748638035646925;0.92345006073877855535;-0.45809929937301513414;0.78664228152354687129;-0.614336251252640686;0.14967917952519960156;0.18387286554603821109;-1.4063423100952132661;-1.4957278162570371016;-0.6474361411482519868;1.1452584856941361302;-1.2446636208264081347];
LW2_1 = [-0.052573559818436511881 0.0038846411553175651081 0.7124656512744764747 -0.02029040814204464277 0.98837785675968048427 0.001781497876660823737 0.16283603998417200964 -0.15278781679740946475 0.033641721029561991174 -0.55025674270720636994 4.0502196260445773035 -0.30811887594975173599 -0.33498209775080833861 -0.22064280503545166678 0.024243271952510921097 -0.10431893232101598079 -0.99884894695048453972 -0.89695149820611541625 0.0019493939208945119078 0.18282071566769630966;0.091809417707805540676 -0.018240947419288684045 -0.36145850592675027313 -0.010611708181815868862 -0.40291282474491213472 0.0071862544097691686759 0.74186057812605432638 0.20730233024858360502 0.3514940608267776434 -0.54446919785917824441 -0.21548019549689431673 0.28063909125007074907 1.0076310146118101496 -0.74330500272048194432 0.038755337417044344317 0.50664387255771181628 -0.18055272372913799828 0.12029870153657187815 0.0033491909230665048956 -0.37867345829133669532;-0.35795257188711238072 -0.0094818911447875596499 -1.2010906198181314775 -0.11198005460124749177 -0.067939545358378816697 0.0005522362812793353299 0.11546017334095765028 -0.53441754695618093329 -0.39035608623921691507 -1.5450987548565122687 0.61051564072114350434 -0.43721992405381349123 1.3351382086275132011 -0.068120361354461950176 -0.10449156710568725803 0.046018275278642800652 -0.24779618997292660043 -0.30084234385464292405 0.0043481556657472423058 -0.092915726726054290174;-0.15944020604941927521 -0.0043179724875150073127 0.71360506639040777177 0.11790210267045754533 0.15634051010914634672 -0.011384366536197777081 0.98042767235738614851 -0.89418844104697847719 -0.43094940429248951297 0.060329027173739405154 0.020351494625390171428 -0.52037091306340532704 0.23828551453539889571 0.51712772582747323913 -0.12101394066538767591 0.71122889135896549817 -1.1762251791013593749 -0.67731938655788914705 0.0099067039212540272675 0.18774979864389998441;0.25788627434170119379 -0.048078678316198351916 0.084281771055377832647 -0.23096528857279313707 -1.4082679581664943047 0.21734498711666139226 0.66860385281317002981 -0.33580713047427601659 -0.28757071896656050125 -0.15192730116458777467 1.0054821673108389479 0.13374735438163859458 1.0602853452465752504 0.78397762493614275847 0.18876947487289769123 -0.77400108189357919031 0.36795840571613014358 -1.5833267396819155071 0.47701830828289748521 0.46474344661677374768;-0.20166246588419731167 -0.0048813126827564525673 1.4325332526569645175 -0.073571926587453387314 -0.28730398425686054509 -0.0067163452243482728993 -0.048637111390725004667 0.28811493781950320292 -0.18029734074895689688 1.3338828942894405127 0.50488706258000515259 -0.26361050679060965551 -1.6426320492240167326 0.57143343606594687589 -0.045610590864394083555 0.14134156334034556068 -0.25392440699906781987 0.48394985961415137865 -0.004375296045595106556 -0.15267700422501928603;-0.62346424252490473261 -0.008086916935940029888 0.75948713513898835625 -0.3104161623841998896 -1.0557113439345056083 -0.0023552443754317740378 0.62574904368075467964 0.4163517399725108481 -0.14490714490067974074 1.2341267666175883555 1.7540395767497913848 -0.61524289765307449418 -0.035754832855332818742 0.46370598958872188966 -0.040968794749308791447 0.13638004626680585996 -2.8326279789199912962 0.38155078736151043506 0.0021388522813479398516 0.10608792468466611558;-0.22359662399053473192 -0.01078773801738422411 -0.11385042324081533216 -0.11933583903044846231 0.572560177231448586 0.0079999765719796604724 0.75007052620003344945 0.0063348141254069489578 0.036641298695626080273 0.020130043075805827135 -0.45973332260333676924 -0.96040244509042915766 0.1456475162588625194 -0.13739495192310224869 -0.010086523417137697664 0.58118345115672986889 0.45421255047157776952 -0.050129198309720214566 0.0085926334763742548417 0.090735141378080572117;-0.82469367411093175146 0.0095099154982554341686 -0.63254387543316248355 0.30922007666192319331 -0.17740755373297401043 0.006923657933861918079 0.035368167117614028594 -0.091111748798644254244 -0.14524945878148834422 -0.053130564471128960413 2.9830814036419694979 -0.037444082375526870077 -0.33362156983540042221 -0.088061071746845895336 0.066044473297033057246 0.36596731915039321104 -1.9249049277896297383 -0.41600186913893894003 0.00011564205128561555371 -0.20860945062966265717;0.13184073084509737028 0.0022498788742914234071 -0.77932319584970355386 0.036738180215735827261 1.1706930857122230805 0.0020146108890338088222 -0.090971383837547076245 -0.62019334898269184997 -0.020542272205292266135 -0.45038347922376203991 0.35745648569036803099 -1.550934729377576371 0.69843156059510325129 -0.67780858729388515638 0.0071397854768957356303 -0.13613918437944735884 -0.0073074738698582584334 -0.24805738210468714078 -0.002269047994091614312 -0.037556046051899924509;-0.09784067637481295987 0.0039652017404556410413 1.1059624970773791475 0.56304431087541340073 -0.63555098166382439917 0.0022177122019664892612 -0.30257406860320351649 0.73809526936486968829 0.10880604125470046128 1.2102512319711722366 -0.48712069895743081993 -0.04313693921208470311 -1.2737738958317659232 0.57543632681960854569 0.00083548232167516612613 0.035836576297991862283 -0.15400510400521241761 -0.15599468091164275796 -0.0086022633832818079513 -0.036760954265269707442;0.1063285551472765017 -0.00077813515830711806835 -0.88487759021293654893 0.14717148379303057748 -0.39288802011436052553 -0.017695459736172397536 0.19408228387968734507 0.11461876653271869941 -0.5076100583865204019 -1.0211042621290411514 0.49321904170929364852 0.31983493352993613845 1.0176843584580770319 0.38893078145761539322 0.11605793336162850693 0.16169598567386425647 -0.15771811622904616246 0.41493774592593835049 -0.0071484430951095296117 -0.29797772810536982124;-0.46949118220902524845 -0.00070227085921978934895 -1.0042683098906628469 -0.95308938832855172318 -0.85746379566832742203 -0.0033676393385666646835 -0.068001020210585308434 0.019006100958266530093 -0.12428047149530961624 0.71116664639629567635 -2.6050704030493632146 -0.24959785897600267335 0.52427290360960587812 0.40268595899203585287 -0.051605101259109394107 0.50343413453792851264 1.6826024933506413817 0.068402902216394029233 -0.019422507932143472098 0.1600162258989475117;-0.20291510371376292321 -0.0060620180286444919071 -0.487298309648987793 0.22574549193434245709 0.47648953121164555613 -0.0058899373003000830146 -0.65264575651304446158 -0.73964518134546286543 0.2143178525266583867 -0.36665641344428118176 1.0668065700138820162 -0.29171232951042558312 0.6691679173767477451 -0.23192231109573507863 -0.078078238776502953411 -0.069337788020503166031 -0.98316537193060116184 0.31136328263411772177 -0.013274924522523571732 0.038834050716550813642;-0.16572873939962695644 -0.0007257307521737890255 -1.6469480099827358277 0.12781188193720469104 -0.81916200477366352128 -0.00082624212484363622391 -0.44554558248204034765 -0.94084756737053221176 0.1923074226804966369 -1.3496256372411734592 -0.90859257011800143022 -0.44771124454870836473 1.0236342455012714669 -0.00062814977221131457902 -0.054922380955433877658 -0.0040767890899998469184 -0.44337090397943629272 -0.74334143243956429803 0.0026628055290221146027 0.34575807009553821691;0.018477839239807176963 -0.026746179930382956574 -0.33722877890491548269 -0.39959976324188045682 0.532894945946608245 -0.010906390905760354054 0.054225429566906131751 0.42037070482282035133 0.98444647793486184106 0.97018176468469286 0.051386219317921616456 -0.34808195422267135255 -0.042232281596458982886 -0.43330304924415058432 -0.4145319402710534451 -0.36047593205273242845 -0.35910238547663142494 0.00309074793574694957 0.036531686085724539292 0.3965791537799602251;-0.44556307571356013053 -0.0077092764380618725162 -0.2846011397835528367 0.85522876980474094033 -0.062934040677079541859 0.00062911025544533068568 0.43056446221722072254 0.72066676633483273129 -0.073008665429487445975 0.42627422417140437005 -1.9809388027838867874 0.26272072833174658912 -0.27010042030518333078 0.28317374619310109463 -0.033512439859975137746 -0.24161384622312528925 0.37537751044566847192 -0.074094246864328888735 0.029282650650798457137 -0.014199381838151645813;0.33809998892047204988 -0.00066121796953074634447 -0.30726619841569202674 0.7296428274103532452 0.41866022249869866423 -0.0036653945416375453489 -0.026586618692084104665 0.05391177323123517301 0.30922678795643798733 -0.26138004466574188411 2.9546499145781210949 0.12234776004214281686 -0.27398363614911058761 -0.42890486395006033327 0.034489837107494397683 -0.38525691070307094277 -0.85900211505051038419 -0.01826641457310704264 0.004296941219066255889 -0.39160076752776240561;0.16101950053285929432 -0.0006885153943563682025 -1.0622476928697539567 -0.35303060256916141135 0.10127473958644575558 -0.0010090558969686011948 0.16254141145249104139 -1.5437537124438760472 -0.35875437229661449878 0.0069187994823341298842 0.032087438669693206517 -0.45505929831669400532 2.2129771747280977401 -0.50176671526925586964 -0.051759980961495977159 -0.069995112623820979203 -0.10090937659301109364 0.50511764599580233348 0.0014691677496154460607 -0.01139383611147591624;0.31918206348809513573 0.10311630975033046764 -0.64005924076994469285 0.6159165301341493759 -0.54235631469266731841 0.16085785775369440542 2.0495453301307717808 -0.091087465174271742274 1.0253335256061646419 -1.0390750960084988996 0.26456960074885488288 -0.54903256902361818881 0.0074819840007121244871 -0.70145407721363850495 0.087614087520129071973 0.61640850252456302893 0.011434710165090830603 0.5410122658362371828 -0.19699343011510353496 0.36089873369518055135];

% Layer 3
b3 = [-0.71249398812332453979;-1.4781717721571236979];
LW3_2 = [2.5214532999410996794 -2.4237997539382485357 -3.6651106074171981852 0.57526207404206242124 -2.1607582410609493806 5.9106908574014100921 6.6089517773007360191 -1.5524925077055662381 3.3171989013045908301 -3.7835175541287231482 3.7026804765980370071 -3.0194598952958155991 -2.783685542537366775 -0.026727464320089155958 -3.4193355712885824538 2.0330345388468571421 -0.85173490052317457621 2.4953457640626188763 -4.0683537327437813147 -0.93629392843335801366;-6.6621993611379801692 -1.7908264510919411627 -3.7446047154487858144 -1.2021593549499900444 2.7369261375543043613 4.6986623901428439254 -8.054942467385611593 0.96852103440236680942 -8.40017454213124104 -4.0620683467657237031 5.1725813306920160883 -1.8264606444466584545 6.4944739058922928976 -5.4351181386186571132 -4.3594947940201240755 2.2160210127328623386 5.8034096050536518874 -6.0704534503055880279 -4.1506174159416886482 -1.1383992913800713431];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [4.24769523777236;4.21031399789945];
y1_step1.xoffset = [0.0858057439698063;-0.238730901736533];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end

