function [Y,Xf,Af,x1_step1,y1_step1] = myNN(X,~,~)
%MYNN neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 15-Oct-2020 18:47:06.
% 
% [Y] = myNN(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [2.18583966895541;-5.04777938719792;-7.70654666579932;-4.09489767662831];
x1_step1.gain = [0.904510143378417;0.2288417321202;0.125836856902032;0.292450054313321];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.7734722170189414214;-2.8730844642306538894;2.1273905435783468931;1.1930935402721147831;-1.2516888263796894787;2.8016624264033120895;-1.0573652199845824384;0.06681438698742543647;0.75418414347905737838;-0.22806856534230762756;-0.016259143948254079631;-0.39753335062229383512;0.30718068948490456771;-1.1076965933947910958;0.81312879734383880503;1.79922191471945081;2.8209106565302484171;1.3304804073119638197;-2.7945302440026509316;2.0431385518525204681];
IW1_1 = [-1.2546223600817738575 -1.3191522353620523944 -0.54658998359880328621 1.4349568152668243926;0.15580690611382283506 -1.3960899285473746811 1.1169942357961257784 -0.24849589896729248895;-0.58319264974966700255 1.1237657545138108883 -0.1786344010577261554 0.21829263849489868865;-0.20690825373560700617 -0.69159111343451529219 -0.12647624280391006613 -0.39033206835542960667;0.25303260592823217934 0.20796461056151077651 -0.10775088570282698175 0.14916235399443278364;-1.2556765743517845912 -0.1671780373886289639 -1.1559480599198810324 1.0217187536917478052;0.84202213483776078284 0.328500641440589769 -0.35234009079380201879 -0.22847527309094847747;0.4928168178598782978 0.20232486735998708727 -0.36208740374889208935 0.10546143445317864018;-0.05457079608331685816 -0.48521599253654362771 -0.16957296355987952485 0.18090758949009178025;0.21496737980200161799 0.47651255839016670723 0.56021746391815963051 -0.094724863225165337188;-1.0751835663019604361 -0.094522007723287421177 0.10192376066342202778 0.024684867903526173244;-0.14817978132374770572 -0.15389611904520783536 -0.02849506764387187141 -0.098574187114568279089;0.014729385173421481389 -0.096763700953173978347 0.16852101944991493276 -0.003019009540008973317;-0.44687323579085014291 0.06236079657601309445 0.014024676118168351649 0.04730319216385602682;0.1864862396545954315 0.16950145541069341903 -0.42052028039442018725 0.03973039904589012461;0.70822959204937518951 0.30443817298324077347 -0.67326512524931447778 0.12530666031663797999;0.97165906044802774488 0.10282923527782318607 0.88187809248285042862 0.019227845082661561976;0.099664692168385332627 0.28619472861341305192 0.44441810905818079913 -0.0061576521377948081198;-0.51767618796853809293 0.270678457026388819 1.4393306920877089183 -0.1620121959229542663;-0.022766022787547465084 0.35178363324281003433 -0.35607175184585537764 -0.1343164671855881509];

% Layer 2
b2 = [1.3288367945796344394;1.3514187495980498621;-1.3091579843075087375;-0.65603613522795367619;0.89089813225764513671;0.55105197477224221458;0.41771142576793851564;-0.40532003282747486317;-0.1546299195780581337;-0.022648554357552089927;-0.31846464003638313978;-0.057987894873487030867;0.4099203155728189385;0.75714032258657726349;-0.93559460039132413822;0.81892409923221765045;1.091514352431092183;-1.1229199084798828778;-1.2430562496428911867;-1.484825392727946447];
LW2_1 = [-0.52743538141894263926 0.71051647122542327395 0.083309678388544236571 0.031875610064983676828 0.0031641886641038713575 -0.12832311762410225642 -0.02523577565808276732 -0.24405887503624601464 0.48566206828079144797 -0.36103690169162194756 -0.26102506278001841311 -0.37604518597260433443 1.4001562566954608435 0.10269296786478548933 -0.28232359869714446221 -0.19243036282325992614 -0.079476642675514908021 0.35931080832406364634 -0.16331294240631030745 -0.16707441530202540858;-0.2416309451680496434 0.70426211350645762099 0.13647413102224559278 0.032040257207291984731 -0.62901275240837384306 -0.51843311923265700258 -0.54161369902576894653 0.23012663890678625167 -0.59317140405606272324 -0.16135234125285180529 0.67503986721071274069 0.99573897660686983002 -1.5491972232362007933 -0.52038175779859574543 0.16485430047492971584 0.089956014732309713677 0.71182067345313637663 -0.35060656723847244409 -0.091523333884069579813 -0.98919830022396826319;0.40560491679844967727 0.24202161159588073125 0.452229716561619699 -0.44106385144434034906 0.6928906234735977554 -0.076779340265291970424 0.041325989225490328272 -0.5387360347236014313 0.19429785448493994138 -0.4911155305181494346 -0.55630287376312193004 -0.010139644620875890371 -0.15869434267380078118 -0.03894172544413375403 0.70947427333184720499 0.24720612202358990817 -0.77106050232672296296 -0.26104778570223274858 -0.23649148982722673074 -0.10306769564941919981;0.62551649543397158659 -0.41678873268564475829 0.98394668063120938051 0.049353889840982961834 0.086145459160381035457 -0.40116679912036518063 -0.27909531622695443742 -0.30408544550784905036 0.33164094306315944349 -0.42222862658119297841 -0.2504046551489405581 1.1421180333239215887 0.37084992305320835237 1.3151173751060107886 0.86479258819033655303 -0.82795545520929592076 -0.27467203694971620287 0.48303241830307735993 -0.52376775184150525799 -0.15967376701861968336;-0.35773140679563092403 0.044777540818269533085 -0.45303006102885989836 -0.031426060676993841647 -0.42494118851428275274 0.49633032594109349755 -0.38912641594134084189 -0.2530449953187243195 -0.68652941751884766219 0.36724109954837208525 -0.16077759067041272334 0.11697941913701423444 -0.64510215576386653602 0.1495382877013325118 -0.42733565740081830286 -0.31489066939758275643 -0.72977424336670926319 -0.55777518758639998975 -0.14337102009783828094 -0.36818972897802715316;-0.45559192339825127505 0.10152401266498367605 0.43756112981788536365 -0.12414229820349480249 0.40380668511418776889 -0.082317630663489071985 -0.20127002551049738566 0.0056432179986378875128 -0.27063256798296919658 0.48903112993776359785 -0.79343659021175849677 0.30940190857424293425 1.3032741039232431657 0.77421066304443175721 -0.14779012503914359944 0.13028882997219229378 -0.10078126473152737574 -0.45451873588575381069 0.43216263495037587905 -0.079872339341544376645;-0.19553457334466076145 0.48136916564498316573 -0.22971503977984850109 -0.087375671467609231091 -0.66926859056789023139 0.015896680937360088692 -0.51073379234288118766 -0.69176956542981316023 -0.59461706411604309253 0.10498608793777682024 -0.029939843394841323537 -0.753552147035139952 0.20669261914787789847 -0.010461134589099318343 -0.12564877483757880272 0.081631140709638339015 -0.13145523170090200882 0.54170402491138591738 -0.43653761029110649261 0.26788530401777355117;0.2115103942606529619 0.91515446439719105864 0.0076295806329788034422 0.025286883618043671379 -0.28952851553444736155 0.13811592017250137743 0.12618249275204782012 -0.46514854031771246667 0.26438163063469255487 -0.29257286608819887963 -0.28094464560136123144 0.21226313994299550458 -0.79695991465645932283 -1.2531871665548444117 0.19233262504498030432 0.20742620811845952078 0.3682739341785306042 -0.62580460109721058881 0.79308256412986521955 0.12215880730242668906;-0.084172887890641687192 0.39489191082473829031 -0.24213726457932099878 -0.0018850803432491258695 0.6860081462082835424 -0.11872981364656427783 -0.13238625636171863498 -0.52486712147368619341 -0.12660505611153002881 0.18750653484210677568 0.41553605098952761665 -0.4022121613743513957 -1.0349801359508261633 0.11405820365428458174 0.1352161122392382675 -0.22799379106488348867 -0.053769194439538155195 1.6317088675800457409 0.11456224343845614055 -0.49122225147456100025;0.53701989037466202337 0.31082191489414018326 0.51156036827705986259 0.016557290401463559126 -0.26780744360495373213 0.44837239692360036925 0.03303658976504564998 0.50491241135711850685 0.2290801559350160721 0.44005661722310673856 -0.24194761379805584944 0.64838363469721493892 -0.70635038068697619806 -0.50721297026314426937 0.4840345346115206282 -0.17444826708713220831 0.332416223553595791 0.23552456878447253219 -0.28047589253096960604 -0.85995495136777577727;0.12459148037600592529 0.060302188336356657428 0.024524273706574013787 -0.026975658751785328016 -0.41551537956258360884 -0.34265905530552476232 -0.044673727966422861757 -0.032378222501865755456 0.31722933909638845185 -0.018773946550560857011 -0.04185623611966816926 -0.1068726254236802703 -1.1980044491223864611 0.036073647721876885008 0.29771390855756529881 -0.25290723446000046293 -0.076104651758411204221 0.067698860165422536372 -0.05699347887449389416 0.19262154994939753583;0.51854356580695526446 0.13635631213871252099 0.14871082786983499946 -0.072705368204121462172 -0.48899510127287748595 -0.3242581886193929841 -0.014696290228899016803 0.06712877037587063056 -0.059379011188808748789 0.27900995371318204619 0.34513986748165470519 0.43757644374957355149 0.44376485339986798673 -0.3752719169795109555 -0.40766382599442940737 0.24506874649834883839 0.030919741732408256157 -0.053553275382211266986 -0.31481517819358567634 -0.146534372708862215;0.32493083902828856502 -0.52525900539128089761 0.072385505318194820479 0.050315975202667465038 -0.48741756840613170709 -0.37483173899275828989 0.13499266664084680345 0.020822030782410343164 -0.060311092237468479083 0.63566295676350570432 0.94212329781848380694 0.21501803541983871559 0.40271281040662471051 -0.13140568295223489792 0.012904816315912632368 0.22424579283860496259 -0.49169373178941372382 0.62141042456358275281 0.19468268487272200051 0.057860382604267270035;0.40573594573522286932 0.37428365671710417395 0.053736608074933051027 0.02858306259145442646 0.51932503500929605433 -0.7260769325884950387 -0.031262899835070349919 -0.17275650047352628103 0.23573162094608451911 -0.60361294146133881444 -0.025883171006410451986 -0.2710549200884008747 -0.1338509857647242618 -0.37232308580529765996 -0.82610799308123927798 -0.019447345800570565999 0.11363994425735572669 0.45259748353019635392 0.15500354402233329498 -0.415928953162292947;-0.6607769598618348228 -0.6383589419741965143 -0.28780542324285435241 0.13747945072305609027 0.21316493909933117989 0.017963234988686248988 0.28972463715705087939 -0.75007599270088531895 0.39237608747474822524 0.47732077215139695481 -1.0152630767436774395 0.96999100005877736397 -0.72580140792659031401 -0.92610576352314399884 -0.15854095083638414243 0.60918716475547307621 0.88441752806619500227 0.3787635482794031172 0.29663356534318729985 -0.29040214145734988271;0.15677201350759817355 -0.34041025469676527981 -0.26608257987693872959 -0.046527938329777161763 -0.58394251344762926337 -0.43600687520546965725 -0.081593419311101797464 0.11075385108881186103 -0.029994891081192964766 -0.42932036262407280436 -0.45336329462459817874 -0.24336359524726000614 2.0360930457229247104 0.82895070901402745367 0.068363438430498246756 -0.22554742848147851797 -0.2751051517514771505 -0.12721457658666981971 0.32747640236855890539 -0.55347463800383589483;0.069369024426315123444 0.53588411224714227465 -0.41350598490234796722 -0.11132586013367280764 0.081037036165350129213 -0.045952567351387849093 0.27952480722226363818 0.29343901115865023144 0.23886424377690018694 0.6322377525862286074 0.34361049059292592123 -0.012159643018010800677 0.001446738642381682283 -0.53491124907162079793 0.48615408288422101712 0.18174001276047294096 -0.13683436915588320648 -0.37355049397395567734 0.36026931770838899194 -0.21005702845265739054;-0.10480096955701616313 0.32829054291943005062 0.41012681449766819064 0.011893896288908481496 -0.71902473490730622885 -0.26944027149305388447 0.072641442136294434584 -0.21890417918424109889 0.09915997213579473557 -0.29375857372411112722 0.27828050514988439401 0.29084566662890237732 0.37985306002818564064 -0.1209106376535999533 -0.21244810480501652439 0.21493100742299239836 0.1606090116026271386 -0.11335014658094350049 -0.44042786240439552037 -0.71592626728488928389;-0.046041024678272549076 0.1235832761398956009 0.2221103493582634314 0.1613227462920930888 -0.36912711064336151123 -0.067594607684602556197 -0.24643526233725981944 0.083914870571520153164 0.60456292531125177536 0.48670992392818279715 0.048255782002143393639 0.50956784281584566187 1.2292124079823163463 -0.18576520314797473343 -0.66457380824203537983 -0.15383766169871085361 -0.29628452810535405026 0.18982976010970947778 -0.011496313180763497244 -0.09277644630461730213;-0.40887201996424354933 0.18964696586948207035 -0.4460311728402460707 -0.66546611202462446766 0.025316125284239758553 0.095496707032571098717 -0.33001671166544299663 -0.22505437168754871546 -0.30957747933700940912 0.50457787188230884823 0.49698002274810498813 -0.67047464959334146517 0.048782418916263038666 0.60665710866613786756 -0.49821169857503644351 -0.22238150833271908002 -0.13504729817515759294 0.10509179069583526878 0.1284794185141341083 0.28062351141034747037];

% Layer 3
b3 = [0.75190502758195065791;-0.9905272273494103441];
LW3_2 = [-0.41742060494443927743 -0.75889547680378877104 0.19085353368189181267 -0.60621216734169658391 -0.28591119235259176978 0.89482309194242037886 0.3339422415833830371 -0.345233944920650071 1.36755803877116211 -0.086067503179307461303 1.3070841966382715782 0.34784844986549268153 0.4766150324416137396 0.71679565586947391331 -0.24755366935553077545 -1.4370981876585680048 -0.73872755158036673695 -1.0290310510353322115 -0.55323037669086960744 0.50752531945961509852;0.69234553584902258638 -0.46140333525841908946 -0.082755992463439981277 -0.3591718793539114829 0.099277240254897744509 0.51051596477503702332 0.14564643448636094281 -0.39725709212981968887 0.95649699471729443534 0.60814476526237126741 -1.2598698768712548457 1.4137394339555786615 0.07311684594243751667 0.52846911465715917799 -0.22165861119253035816 -0.054138800989646934658 -0.2966355188164085388 -0.25767525619206277376 0.051266730732389777236 0.20999872414530615372];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.2288417321202;0.122083495329215];
y1_step1.xoffset = [-5.04777938719792;-8.19518280275366];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end

