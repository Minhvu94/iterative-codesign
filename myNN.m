function [Y,Xf,Af,x1_step1,y1_step1] = myNN(X,~,~)
%MYNN neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 15-Oct-2020 16:26:54.
% 
% [Y] = myNN(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [1.98715754811491;-5.29529157466874;-8.16151240238266;-3.98211677993961];
x1_step1.gain = [0.93269929950094;0.179157968031349;0.132130812853298;0.246972964783332];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.6534855071306076013;-3.2096057634249852697;3.6862115651498359448;-1.7857906952046100901;1.6289821958904671106;0.9908818029971324659;0.51953683212038326289;0.5750233910202390275;0.52457510302860221874;0.25435628136908627894;0.85542113534957198162;0.40745227131896050166;-0.1573520836172519477;-1.7974359132748509715;0.36055726387198311356;-0.74714484928667967978;2.8476564032191125087;3.6912428847258036413;-1.8836244226943941182;-3.202559023633801516];
IW1_1 = [-0.84448797173817902184 -0.21884663022392006337 1.762228295853148774 0.089664874988968412683;-0.031156593553713484573 -1.2385303599579642331 0.97768734019464986762 0.48043561896925424115;-0.0073666743785675082093 -0.81960307157324585603 0.7546083409574951828 -0.076656152535594240804;0.58931767810414503739 0.41880440650514305645 0.78842051272288926622 -0.11684230304856096927;-1.2636988983759538385 0.84329384811200081007 -0.086664450787647132057 0.17448998112850655495;-0.21796540314009574257 -0.26153726110686875694 -0.66065432922304279106 0.36663155514736256446;-0.32558219995584619655 -0.37269033378165800086 0.16932430588813238148 0.14346231418665858492;-0.099253875674037081445 -0.32124955445356978556 -0.034640817393967474058 -0.18912692450494786311;-1.3131308167501101192 0.097061143071325850507 0.031389571461445102407 0.085295120520096343042;-0.047283607725191550974 0.28592030097492898699 0.24530607462465725543 -0.10793667414192986698;0.57044921722592856206 -0.10870932864057782086 0.16399964939635267025 0.07596371549638741838;0.24045702070153560093 0.28461349278083503123 0.081800848604973483424 0.14088115397618183877;0.0070494398265193384395 -0.18503869118449159381 0.15482556675130990098 -0.010096121013296887464;-0.74712430230384574426 -0.54415937798806435222 0.1985588788118517467 0.13468306326875373324;0.54711505594837361866 -0.15796192363171848716 -0.36156845122687314431 0.12301934661351537903;-0.10023553971528142981 0.077502480816972682542 0.21849485594280707024 0.0233006278078407153;-0.058838408916372715585 -0.030168310634359374323 -0.5937002622981309985 0.74762459543625314762;-0.19300438675701267477 -1.7271106460053362586 -0.051117258050947383952 0.97280032478081701619;-0.43377945361003544811 -0.5240105923064376503 0.076499999531046414258 -0.17754570674422873178;-0.7594132318900134182 -1.0733539566531145049 0.43461877542161775345 -0.51264609808678118785];

% Layer 2
b2 = [-1.7087594733824780224;-1.2216175562269071531;-1.2554676136350320093;-1.0511950928212181466;-1.0347606826867536967;0.47003076135351418152;-0.21958141914245241089;-0.70596683584648800558;0.070671042783251841746;0.4005431959957092003;-0.37827705162115693449;-0.2933109258013446019;-0.65428705748943816189;0.39381806134766417227;0.74508089293535506581;-0.81191827476413591658;-0.77941788698859804096;-1.2191864501721345615;-1.4437582220421156798;0.59514477409942889707];
LW2_1 = [0.3317576018867424148 0.34143243207551765561 0.17294354143784687605 -0.095256093746700132296 -0.27408710067687880318 -0.39717426672605887772 0.76327700535210929456 0.31594223829156098393 0.11271669443208218175 0.66519898790744402817 -0.39216386090111260421 -0.064317389185979789712 -0.48343902732530386057 -0.42886188052193746634 -0.34999045778097864767 0.58464016381337835515 -0.1622507441827260033 -0.40197302806503393269 0.16502429117958999916 -0.19072763403472026145;0.5387416056364341399 0.26045136362075327341 -0.17098332221499037975 -0.24451339766002691545 0.16991345021404158366 0.72576371909779413549 0.13436812482144527836 0.47771549912308236552 -0.16565240605941575214 0.14941632112940353427 0.1111694765629815812 -0.46721995084635653539 -0.53464322540645692339 -0.94220065584670997794 -0.14601205373665207543 -0.17853809808581858065 0.10878819819767242272 -0.086512473411379339772 0.055847317784405756114 0.13841778351905700828;-0.036736419824017263469 0.32428939113734567279 -0.28231382348775524438 -0.25516043939947002928 -0.19028151045909857952 -0.34745470558720820131 0.10962852099980632814 -0.60616114427540868093 -0.20696864408635601285 0.36519896840525867265 1.2643110969912305652 0.42371664660833396887 0.99091344799036240598 -0.67415437919698839586 0.68364231976475231534 -0.52444649138214083361 -0.18599964184153747193 0.17075293416817635683 -0.509773040747975692 0.50948129594357904892;0.019837743333136488577 -0.081568724844605283719 0.56036385444950642665 -0.55592411415245035489 0.091704146227394062185 -0.26603945875261275633 0.43937318943545056182 0.033386147427772940033 0.60377803476107771985 -0.68290638127694491821 -1.3814350840632214634 -0.18100016965003848379 0.14887271526958772982 -0.62397301785071734859 -0.16324556214475602345 0.39164406898094278331 -0.044038705498797035831 -0.34387620381848116313 -1.2253100084384662694 -0.16360301684158923274;0.18877104073853875899 0.23712290507040129084 -0.77242758648271236943 0.38098128357025784485 -0.78705761492688974812 -0.14129794132210157787 -0.12794657160501551885 -0.29149789396070113767 -0.61548683457620778636 0.27432925681399045192 0.097005762650837795702 -0.4700637295276266503 -0.039850185554939306087 0.036837261514184982403 0.19432756927941965963 0.53818222979042040777 -0.46576329631863633285 -0.22994053177013004663 0.4863041574715574189 -0.030839441873635301677;-0.076797174176500435094 -0.073937212314031802718 0.74374131745088534196 -0.17551304403417358757 0.20424769251492966293 -0.020028077991565113036 -0.055809309625223652018 0.42134520522256535546 -0.11265517663169337392 0.36593015944181378485 -0.090807272040736936036 0.20235538063690211574 0.4972032555125033837 0.27360193619608225157 -0.21859290706435657858 -1.1083510720646618797 0.30178309163061983744 -0.18250177850266333102 1.2324736141315768556 0.10315089949176782513;0.30161633738012272321 0.20666473125601253491 0.1944727240440363436 -0.026653396306574206331 0.07308122689137958039 -0.1573795762671013343 0.28726067321435094781 -0.19291014414636775687 0.16079655000314704849 0.22783349054620605223 0.0073298900135549613366 -0.0026182964971948655651 0.47530691540363995129 0.014380847963040871429 0.030651544350115900867 0.010215124941096959815 -0.16407101701419785078 0.29441380454532467548 -0.42406684085066498335 0.14143851140536506383;0.040190397373415925886 0.28020306716616866227 -0.54858124765865978745 -0.44153364527491834046 -0.52272239107433848826 -0.35621843121218599304 0.56471508203470566212 0.64315107629197731942 -0.44202296574273491903 -0.069472642138312279414 -0.49564205703383840129 -0.78735697979687946368 0.50339864049585314465 0.0052624013992482168364 -0.17202586231504418679 -0.13844309094591572551 0.12153904405171810088 -0.12391000575036412168 0.13460695049896739817 0.030930608229438015522;-0.00043027261116688737905 0.059487908157653777985 -0.032755210744758060659 -0.12156508591685628862 0.26664103701433083948 0.2122642087074452788 -0.44785450957723005327 -0.543735328201382484 -0.74039870337929902799 0.43741709840436265866 -0.40726044296906832587 -0.015505857264629717071 0.48291475339724304616 -0.012305857558453332096 0.19450403469516630572 0.68852541477734396924 0.49087169699221006036 -0.45252435433269522225 0.091866836448082633826 0.28283048951483136246;-0.39366905767862819809 -0.052731001281418526938 0.18785834842147033918 -0.6122349250520806585 -0.070501716391332500122 0.10672869399978870963 -0.10035680426916170072 0.10344641620744914057 0.066740260811385357376 0.022983003769949505307 -0.25988130537832321298 0.15719194075128634092 0.38918943684858536836 -0.061915319191025011691 -0.53634878055445367462 0.72706227087069397186 -0.23250809859427154502 -0.40369443253374626135 0.060234858540592170484 -0.2365533416771752051;-0.34141263933459148339 0.17755642181234801424 -0.55779182822769901584 0.5123857265297284691 0.16781262597355647848 -1.1600865540933935627 -0.1974008838076743988 0.63158727494140920466 0.93503867113841598879 -0.97141575115896772186 -0.33370135466182637707 0.18685519102989697759 0.69058612274602193537 -0.61314941692980517995 0.85716719772603011673 0.21266492868466307931 0.26311958642070437664 0.11697487019245386697 0.47194443865401031202 0.35124472713713650318;-0.56903007946556161123 0.03760390382378952373 -0.028442296190163213893 -0.67937401362477645161 -0.05099234136285051705 -0.48607180367616958927 0.30931030297805572893 0.52736689240139433821 0.34572496331801921832 -0.0091686736335907046552 -0.22419760997523108248 -0.47744920866868822973 0.24756328424584586601 -0.2471510487784608634 0.42420030644925843522 -0.040609834104333698834 0.19406039179461573307 0.12389944575017708406 -0.46148163929333757549 0.32303420915269509539;0.064512950892591264251 -0.068514544142396313631 0.34118405500481474579 -0.24855461687903906975 -0.042240670694676130115 -0.17294079444330306972 -0.66973604376139461714 0.17969695311342898103 -0.11194948721383228551 -0.87385924217868027331 -0.25705308743018689954 0.45094723692728549969 -0.88537673176692766042 0.57309033210414295212 -0.68139478019139754217 0.57229362938582506448 0.048262928051382887606 -0.30896471532303926288 0.16806168950226418879 -0.18302437728177176068;0.047988515480554577719 0.51218569596763652285 -0.13903405477455810235 -0.33050789755805870529 0.028247478795995852041 0.17284192701895195743 0.16984800649084172419 -0.057033258489832372451 -0.44693173656477552802 -0.47759182012611556267 -0.63838603791708559143 0.16038177013495091838 0.22224537098375454769 -0.2618920298783091738 -0.12826535569367092382 -0.018269108013398160234 -0.1477683480778045344 0.047062339066705434487 -0.026188979801417978238 -0.02295076149775663113;-0.33825248129026913579 -0.073620055909052045662 0.36012385672594099395 -0.11305317360272292004 0.074510992404196355055 0.026987704327013195549 -0.087094622858879963689 0.54212832700862523261 -0.028026028440983046658 0.2893633378904372222 0.13037443544348065183 0.2773883391821277411 0.96435650221086666178 0.097638249376117786094 -0.06355572559580531522 0.30100197016015473039 -0.024750198858357493753 0.0170249802022048001 0.45109801973057828128 -0.13647197262461222;-0.28888856070058632763 0.11691609690166568369 -0.85916422943015802183 -0.10189741892150411262 0.21555553314416170396 0.34710768925585333555 0.24855248217935965727 0.60061562121846290285 0.19536070065310867649 0.34249629937106568223 0.38970600252094317328 0.19697801917301227537 -1.6670860122410746662 0.23129663227176561202 0.35472398632285151443 0.38239573742317850558 0.021263857683551878885 0.042661303472520825664 -0.1153605567633483181 0.25184306643604553733;0.10709934943487615933 0.014706863676011774911 -0.04591362391403019938 0.38207848363574892225 0.44921393710286766643 -0.77197858549385489635 0.25576885321753983771 -0.019900633397836740152 -0.56912190182148836293 0.76508747877142846416 -0.64187989414350454798 -0.57149187882718832654 -0.019460705933496601217 -0.97960175482314493234 0.092436195877080809535 0.24215383861377495767 0.36822521041343653225 0.57633049606315389646 -0.0029776246691923615763 -0.026377629143140290946;-0.33507119678768126914 -0.22709148992070124495 0.2152034369982784856 0.1462476089658107381 -0.012077056736790660676 -0.15961357176319498907 -0.71231571504760426983 -0.078929016037496024794 -0.074038568679535829431 1.2781071085027808643 0.88839926664968049685 -0.68806352827745120848 0.077463363572427668124 -0.0039433016234120101332 -0.66622911009916874203 0.72504460980397311687 -0.46840948965577972052 0.66152320266082398348 -0.35626313422768696171 -0.016813500295209300034;-0.39704811969783432302 -0.080718304946852642567 -0.068464628635315508132 -0.04634807837495520666 -0.0036046307332994959385 0.1032494178062417084 0.36284070833122988864 0.19836003042898883719 -0.00094665728551040486879 0.1326482164848808154 0.13756736319461168594 0.2678634503088063723 1.3728579535529585876 -0.041290584259003011713 -0.34601186446433329635 -0.2318323525017771114 -0.2338828463896552301 0.58475645151478405914 0.28172418709147406535 -0.13205348099268199302;-0.021047519663274966845 -0.21900747767542108613 -0.62404452298769075291 -0.72000135378945562259 0.028625476114443635517 -0.16101232453870950589 -0.14872209566968655481 0.082858017987654866698 -0.32760563209005200136 -0.81171646912164918675 0.60836674502120302588 -0.63297443169678568875 -0.55078140959647081676 0.069940716007990968994 -1.3035840215755976068 -0.10007758042411263322 -0.83073528548857067388 -0.33132608700351756648 -0.25216713726502493209 -0.27881242654074284149];

% Layer 3
b3 = [0.41688055659284950494;0.49356631599874717375];
LW3_2 = [-0.10740260632703793608 0.35290940461945580209 0.3120733846058827976 -0.1567407118299258828 -0.43431187369595075642 -0.39078215636470337024 0.24314720333708311761 -0.63334399720365852637 0.3537799488272381776 1.7034431267120280218 -0.94838993496577372877 -0.29040475930811249228 0.76436454244702078942 -0.65811132071488809281 -1.3731138839656067407 1.162598522156707892 0.093545457365292197793 0.69465777196680833505 -1.2493968511399975441 -0.68803873753888300513;1.0713809308543411625 -0.16029243058517883558 0.21421126331423520628 -0.19974787846235661504 0.8007489957020272886 -1.3193819901432142228 1.8967293866495480437 -0.12062170599021231066 0.45713657090338782885 0.75163244287182529035 -0.88080539699111615182 -0.01457140147496467468 -0.49354546551297778789 -0.36626236896412095456 1.7269961468613930222 -0.6021510199950728115 -0.11239417191289763354 0.084882273364780477798 1.0890957154317089106 -0.50375313377684538541];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.179157968031349;0.132130812853298];
y1_step1.xoffset = [-5.29529157466874;-8.16151240238266];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end

